<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My To-Do List</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background: linear-gradient(-45deg,#FFC0CB,#ADD8E6,#90EE90,#ADD8E6); background-size:400% 400%; animation: gradient-animation 15s ease infinite; color:#4A5568; }
    @keyframes gradient-animation { 0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%} }
    .container-card { background-color: rgba(255,255,255,0.9); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); box-shadow: 0 10px 30px rgba(0,0,0,0.1); animation: fadeIn 0.8s ease-in-out; }
    @keyframes fadeIn { from {opacity:0; transform:translateY(-20px)} to {opacity:1; transform:translateY(0)} }
  </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // -----------------------
    // PASTE YOUR FIREBASE CONFIG HERE (replace the whole object)
    // Example shape:
    // const firebaseConfig = {
    //   apiKey: "AIza....",
    //   authDomain: "my-project.firebaseapp.com",
    //   projectId: "my-project",
    //   storageBucket: "my-project.appspot.com",
    //   messagingSenderId: "1234567890",
    //   appId: "1:1234567890:web:abcdef123456"
    // };
    // -----------------------
    const firebaseConfig = {
       apiKey: "AIzaSyAljUqC-fCZwxxN501iU2oRNyNu18GzL0k",
  authDomain: "todo-672c5.firebaseapp.com",
  projectId: "todo-672c5",
  storageBucket: "todo-672c5.firebasestorage.app",
  messagingSenderId: "610086595432",
  appId: "1:610086595432:web:4fe9a986c758ddc63044dd",
  measurementId: "G-P9E3GDSZH9"
};

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let userId = null;
    let userTasksDocRef = null;
    const lists = ['today','important','other','daily'];

    onAuthStateChanged(auth, (user) => {
      if (user) {
        userId = user.uid;
        userTasksDocRef = doc(db, 'users', userId, 'tasks', 'my_list');
        console.log("Authenticated as:", userId);
        loadFromFirestore();
      } else {
        console.log("No user - signing in anonymously...");
        signInAnonymously(auth).catch(e => console.error("Sign-in error:", e));
      }
    });

    function createListItem(text, parentListId) {
      const itemContainer = document.createElement('div');
      itemContainer.className = 'flex items-center w-full p-2 pr-4 rounded-xl shadow-md bg-white border border-gray-200 transition-all duration-200 hover:shadow-lg focus-within:ring-2 focus-within:ring-purple-500 focus-within:ring-offset-2';
      const itemText = document.createElement('div');
      itemText.className = 'flex-grow p-2 text-left cursor-text outline-none';
      itemText.setAttribute('contenteditable', 'true');
      itemText.textContent = text || '';
      itemText.addEventListener('input', () => saveToFirestore());
      itemText.addEventListener('blur', () => saveToFirestore());

      const deleteButton = document.createElement('button');
      deleteButton.className = 'p-1 rounded-full text-gray-400 hover:text-red-500 transition-colors duration-200';
      deleteButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>';
      deleteButton.addEventListener('click', () => { itemContainer.remove(); saveToFirestore(); });

      itemContainer.appendChild(itemText);
      itemContainer.appendChild(deleteButton);
      const parentList = document.getElementById(parentListId);
      parentList.appendChild(itemContainer);
    }

    async function saveToFirestore() {
      if (!userTasksDocRef) return;
      const data = {};
      lists.forEach(listId => {
        const listEl = document.getElementById(`${listId}-list`);
        const items = Array.from(listEl.children).map(item => item.querySelector('div').textContent);
        data[listId] = items;
      });
      try {
        await setDoc(userTasksDocRef, { tasks: data });
        console.log("Saved to Firestore");
      } catch (e) {
        console.error("Error saving:", e);
      }
    }

    function loadFromFirestore() {
      if (!userTasksDocRef) return;
      onSnapshot(userTasksDocRef, (docSnap) => {
        const data = docSnap.exists() ? docSnap.data().tasks : {};
        lists.forEach(listId => {
          const listEl = document.getElementById(`${listId}-list`);
          listEl.innerHTML = '';
          const tasks = data[listId] || [];
          if (tasks.length === 0) {
            for (let i=0;i<5;i++) createListItem('', `${listId}-list`);
          } else {
            tasks.forEach(t => createListItem(t, `${listId}-list`));
          }
        });
      }, (err) => console.error("Listen error:", err));
    }

    function addListItem(listId) {
      createListItem('', `${listId}-list`);
      saveToFirestore();
    }
    window.addListItem = addListItem;
  </script>

  <div class="container-card max-w-7xl w-full p-6 sm:p-12 rounded-2xl text-center">
    <h1 class="text-4xl sm:text-5xl font-bold mb-8 text-gray-800">My To-Do List</h1>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
      <div class="flex flex-col items-center">
        <h2 class="text-3xl font-bold mb-6 text-purple-700">Today</h2>
        <div id="today-list" class="space-y-4 w-full"></div>
        <button onclick="addListItem('today')" class="mt-4 px-6 py-3 rounded-full text-white font-bold text-sm bg-gradient-to-r from-pink-500 to-rose-500 shadow-lg">Add Task</button>
      </div>
      <div class="flex flex-col items-center">
        <h2 class="text-3xl font-bold mb-6 text-purple-700">Important</h2>
        <div id="important-list" class="space-y-4 w-full"></div>
        <button onclick="addListItem('important')" class="mt-4 px-6 py-3 rounded-full text-white font-bold text-sm bg-gradient-to-r from-pink-500 to-rose-500 shadow-lg">Add Task</button>
      </div>
      <div class="flex flex-col items-center">
        <h2 class="text-3xl font-bold mb-6 text-purple-700">Other</h2>
        <div id="other-list" class="space-y-4 w-full"></div>
        <button onclick="addListItem('other')" class="mt-4 px-6 py-3 rounded-full text-white font-bold text-sm bg-gradient-to-r from-pink-500 to-rose-500 shadow-lg">Add Task</button>
      </div>
      <div class="flex flex-col items-center">
        <h2 class="text-3xl font-bold mb-6 text-purple-700">Daily</h2>
        <div id="daily-list" class="space-y-4 w-full"></div>
        <button onclick="addListItem('daily')" class="mt-4 px-6 py-3 rounded-full text-white font-bold text-sm bg-gradient-to-r from-pink-500 to-rose-500 shadow-lg">Add Task</button>
      </div>
    </div>
  </div>
</body>
</html>
